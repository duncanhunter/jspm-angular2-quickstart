System.register(['typescript', './logger', './utils'], function(exports_1) {
    var ts, logger_1, utils_1;
    var logger, __HTML_MODULE__, CompilerHost;
    return {
        setters:[
            function (ts_1) {
                ts = ts_1;
            },
            function (logger_1_1) {
                logger_1 = logger_1_1;
            },
            function (utils_1_1) {
                utils_1 = utils_1_1;
            }],
        execute: function() {
            logger = new logger_1.default({ debug: false });
            exports_1("__HTML_MODULE__", __HTML_MODULE__ = "__html_module__");
            ;
            CompilerHost = (function () {
                function CompilerHost(options) {
                    this._options = options || {};
                    this._options.module = this.getEnum(this._options.module, ts.ModuleKind, 4);
                    this._options.target = this.getEnum(this._options.target, ts.ScriptTarget, 1);
                    this._options.jsx = this.getEnum(this._options.jsx, ts.JsxEmit, 0);
                    this._options.allowNonTsExtensions = (this._options.allowNonTsExtensions !== false);
                    this._options.skipDefaultLibCheck = (this._options.skipDefaultLibCheck !== false);
                    this._options.noResolve = true;
                    this._options.moduleResolution = 1;
                    this._files = {};
                    var file = this.addFile(__HTML_MODULE__, "var __html__: string = ''; export default __html__;");
                    file.dependencies = { list: [], mappings: {} };
                    file.checked = true;
                    file.errors = [];
                }
                CompilerHost.prototype.getEnum = function (enumValue, enumType, defaultValue) {
                    if (enumValue == undefined)
                        return defaultValue;
                    for (var enumProp in enumType) {
                        if (enumProp.toLowerCase() === enumValue.toString().toLowerCase()) {
                            if (typeof enumType[enumProp] === "string")
                                return enumType[enumType[enumProp]];
                            else
                                return enumType[enumProp];
                        }
                    }
                    throw new Error("Unrecognised value [" + enumValue + "]");
                };
                Object.defineProperty(CompilerHost.prototype, "options", {
                    get: function () {
                        return this._options;
                    },
                    enumerable: true,
                    configurable: true
                });
                CompilerHost.prototype.getDefaultLibFileName = function () {
                    return "typescript/lib/lib.es6.d.ts";
                };
                CompilerHost.prototype.useCaseSensitiveFileNames = function () {
                    return false;
                };
                CompilerHost.prototype.getCanonicalFileName = function (fileName) {
                    return ts.normalizePath(fileName);
                };
                CompilerHost.prototype.getCurrentDirectory = function () {
                    return "";
                };
                CompilerHost.prototype.getNewLine = function () {
                    return "\n";
                };
                CompilerHost.prototype.readFile = function (fileName) {
                    throw new Error("Not implemented");
                };
                CompilerHost.prototype.writeFile = function (name, text, writeByteOrderMark) {
                    throw new Error("Not implemented");
                };
                CompilerHost.prototype.getSourceFile = function (fileName) {
                    fileName = this.getCanonicalFileName(fileName);
                    return this._files[fileName];
                };
                CompilerHost.prototype.getAllFiles = function () {
                    var _this = this;
                    return Object.keys(this._files).map(function (key) { return _this._files[key]; });
                };
                CompilerHost.prototype.fileExists = function (fileName) {
                    return !!this.getSourceFile(fileName);
                };
                CompilerHost.prototype.addFile = function (fileName, text) {
                    fileName = this.getCanonicalFileName(fileName);
                    var file = this._files[fileName];
                    if (!file) {
                        this._files[fileName] = ts.createSourceFile(fileName, text, this._options.target);
                        logger.debug("added " + fileName);
                    }
                    else if (file.text != text) {
                        this._files[fileName] = ts.createSourceFile(fileName, text, this._options.target);
                        this.invalidate(fileName);
                        logger.debug("updated " + fileName);
                    }
                    return this._files[fileName];
                };
                CompilerHost.prototype.invalidate = function (fileName, seen) {
                    var _this = this;
                    seen = seen || [];
                    if (seen.indexOf(fileName) < 0) {
                        seen.push(fileName);
                        var file = this._files[fileName];
                        if (file) {
                            file.checked = false;
                            file.errors = [];
                        }
                        Object.keys(this._files)
                            .map(function (key) { return _this._files[key]; })
                            .forEach(function (file) {
                            if (file.dependencies && file.dependencies.list.indexOf(fileName) >= 0) {
                                _this.invalidate(file.fileName, seen);
                            }
                        });
                    }
                };
                CompilerHost.prototype.resolveModuleNames = function (moduleNames, containingFile) {
                    var _this = this;
                    return moduleNames.map(function (modName) {
                        var dependencies = _this._files[containingFile].dependencies;
                        if (utils_1.isHtml(modName)) {
                            return { resolvedFileName: __HTML_MODULE__ };
                        }
                        else if (dependencies) {
                            var resolvedFileName = dependencies.mappings[modName];
                            var isExternalLibraryImport = utils_1.isTypescriptDeclaration(resolvedFileName);
                            return { resolvedFileName: resolvedFileName, isExternalLibraryImport: isExternalLibraryImport };
                        }
                        else {
                            return ts.resolveModuleName(modName, containingFile, _this._options, _this).resolvedModule;
                        }
                    });
                };
                return CompilerHost;
            })();
            exports_1("CompilerHost", CompilerHost);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsZXItaG9zdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21waWxlci1ob3N0LnRzIl0sIm5hbWVzIjpbIkNvbXBpbGVySG9zdCIsIkNvbXBpbGVySG9zdC5jb25zdHJ1Y3RvciIsIkNvbXBpbGVySG9zdC5nZXRFbnVtIiwiQ29tcGlsZXJIb3N0Lm9wdGlvbnMiLCJDb21waWxlckhvc3QuZ2V0RGVmYXVsdExpYkZpbGVOYW1lIiwiQ29tcGlsZXJIb3N0LnVzZUNhc2VTZW5zaXRpdmVGaWxlTmFtZXMiLCJDb21waWxlckhvc3QuZ2V0Q2Fub25pY2FsRmlsZU5hbWUiLCJDb21waWxlckhvc3QuZ2V0Q3VycmVudERpcmVjdG9yeSIsIkNvbXBpbGVySG9zdC5nZXROZXdMaW5lIiwiQ29tcGlsZXJIb3N0LnJlYWRGaWxlIiwiQ29tcGlsZXJIb3N0LndyaXRlRmlsZSIsIkNvbXBpbGVySG9zdC5nZXRTb3VyY2VGaWxlIiwiQ29tcGlsZXJIb3N0LmdldEFsbEZpbGVzIiwiQ29tcGlsZXJIb3N0LmZpbGVFeGlzdHMiLCJDb21waWxlckhvc3QuYWRkRmlsZSIsIkNvbXBpbGVySG9zdC5pbnZhbGlkYXRlIiwiQ29tcGlsZXJIb3N0LnJlc29sdmVNb2R1bGVOYW1lcyJdLCJtYXBwaW5ncyI6Ijs7UUFLTSxNQUFNLEVBQ0MsZUFBZTs7Ozs7Ozs7Ozs7OztZQUR0QixNQUFNLEdBQUcsSUFBSSxnQkFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDL0IsNkJBQUEsZUFBZSxHQUFHLGlCQUFpQixDQUFBLENBQUM7WUFFNkIsQ0FBQztZQWtCL0U7Z0JBSUNBLHNCQUFZQSxPQUFZQTtvQkFDdkJDLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE9BQU9BLElBQUlBLEVBQUVBLENBQUNBO29CQUM5QkEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEs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QUFRQSxFQUFFQSxLQUFJQSxDQUFDQSxDQUFDQSxjQUFjQSxDQUFDQTt3QkFFMUZBLENBQUNBO29CQUNGQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDSkEsQ0FBQ0E7Z0JBQ0ZoQixtQkFBQ0E7WUFBREEsQ0FBQ0EsQUF4SkQsSUF3SkM7WUF4SkQsdUNBd0pDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqL1xuaW1wb3J0ICogYXMgdHMgZnJvbSAndHlwZXNjcmlwdCc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7aXNIdG1sLCBpc1R5cGVzY3JpcHREZWNsYXJhdGlvbiwgaXNKYXZhU2NyaXB0fSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgbG9nZ2VyID0gbmV3IExvZ2dlcih7IGRlYnVnOiBmYWxzZSB9KTtcbmV4cG9ydCBjb25zdCBfX0hUTUxfTU9EVUxFX18gPSBcIl9faHRtbF9tb2R1bGVfX1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbWJpbmVkT3B0aW9ucyBleHRlbmRzIFBsdWdpbk9wdGlvbnMsIHRzLkNvbXBpbGVyT3B0aW9ucyB7IH07XG5cbmV4cG9ydCB0eXBlIFRyYW5zcGlsZVJlc3VsdCA9IHtcblx0ZmFpbHVyZTogYm9vbGVhbjtcblx0ZXJyb3JzOiBBcnJheTx0cy5EaWFnbm9zdGljPjtcblx0anM6IHN0cmluZztcblx0c291cmNlTWFwOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU291cmNlRmlsZSBleHRlbmRzIHRzLlNvdXJjZUZpbGUge1xuICAgb3V0cHV0PzogVHJhbnNwaWxlUmVzdWx0O1xuICAgcGVuZGluZ0RlcGVuZGVuY2llcz86IFByb21pc2U8RGVwZW5kZW5jeUluZm8+O1xuICAgZGVwZW5kZW5jaWVzPzogRGVwZW5kZW5jeUluZm87XG4gICBlcnJvcnM/OiB0cy5EaWFnbm9zdGljW107XG4gICBjaGVja2VkPzogYm9vbGVhbjtcbiAgIGlzTGliRmlsZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBDb21waWxlckhvc3QgaW1wbGVtZW50cyB0cy5Db21waWxlckhvc3Qge1xuXHRwcml2YXRlIF9vcHRpb25zOiBhbnk7XG5cdHByaXZhdGUgX2ZpbGVzOiB7IFtzOiBzdHJpbmddOiBTb3VyY2VGaWxlOyB9O1xuXG5cdGNvbnN0cnVjdG9yKG9wdGlvbnM6IGFueSkge1xuXHRcdHRoaXMuX29wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRcdHRoaXMuX29wdGlvbnMubW9kdWxlID0gdGhpcy5nZXRFbnVtKHRoaXMuX29wdGlvbnMubW9kdWxlLCAoPGFueT50cykuTW9kdWxlS2luZCwgdHMuTW9kdWxlS2luZC5TeXN0ZW0pO1xuXHRcdHRoaXMuX29wdGlvbnMudGFyZ2V0ID0gdGhpcy5nZXRFbnVtKHRoaXMuX29wdGlvbnMudGFyZ2V0LCAoPGFueT50cykuU2NyaXB0VGFyZ2V0LCB0cy5TY3JpcHRUYXJnZXQuRVM1KTtcblx0XHR0aGlzLl9vcHRpb25zLmpzeCA9IHRoaXMuZ2V0RW51bSh0aGlzLl9vcHRpb25zLmpzeCwgKDxhbnk+dHMpLkpzeEVtaXQsIHRzLkpzeEVtaXQuTm9uZSk7XG5cdFx0dGhpcy5fb3B0aW9ucy5hbGxvd05vblRzRXh0ZW5zaW9ucyA9ICh0aGlzLl9vcHRpb25zLmFsbG93Tm9uVHNFeHRlbnNpb25zICE9PSBmYWxzZSk7XG5cdFx0dGhpcy5fb3B0aW9ucy5za2lwRGVmYXVsdExpYkNoZWNrID0gKHRoaXMuX29wdGlvbnMuc2tpcERlZmF1bHRMaWJDaGVjayAhPT0gZmFsc2UpO1xuXHRcdHRoaXMuX29wdGlvbnMubm9SZXNvbHZlID0gdHJ1ZTtcblxuXHRcdC8vIEZvcmNlIG1vZHVsZSByZXNvbHV0aW9uIGludG8gJ2NsYXNzaWMnIG1vZGUsIHRvIHByZXZlbnQgbm9kZSBtb2R1bGUgcmVzb2x1dGlvbiBmcm9tIGtpY2tpbmcgaW5cblx0XHR0aGlzLl9vcHRpb25zLm1vZHVsZVJlc29sdXRpb24gPSB0cy5Nb2R1bGVSZXNvbHV0aW9uS2luZC5DbGFzc2ljO1xuXG5cdFx0dGhpcy5fZmlsZXMgPSB7fTtcblxuXHRcdC8vIHN1cHBvcnQgZm9yIGltcG9ydGluZyBodG1sIHRlbXBsYXRlcyB1bnRpbFxuXHRcdC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMjcwOSNpc3N1ZWNvbW1lbnQtOTE5Njg5NTAgZ2V0cyBpbXBsZW1lbnRlZFxuXHRcdC8vIG5vdGUgLSB0aGlzIG9ubHkgYWZmZWN0cyB0eXBlLWNoZWNraW5nLCBub3QgcnVudGltZSFcblx0XHRjb25zdCBmaWxlID0gdGhpcy5hZGRGaWxlKF9fSFRNTF9NT0RVTEVfXywgXCJ2YXIgX19odG1sX186IHN0cmluZyA9ICcnOyBleHBvcnQgZGVmYXVsdCBfX2h0bWxfXztcIik7XG4gICAgICBmaWxlLmRlcGVuZGVuY2llcyA9IHsgbGlzdDogW10sIG1hcHBpbmdzOiB7fSB9O1xuICAgICAgZmlsZS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgIGZpbGUuZXJyb3JzID0gW107XG5cdH1cblxuXHRwcml2YXRlIGdldEVudW08VD4oZW51bVZhbHVlOiBhbnksIGVudW1UeXBlOiBhbnksIGRlZmF1bHRWYWx1ZTogVCk6IFQge1xuXHRcdGlmIChlbnVtVmFsdWUgPT0gdW5kZWZpbmVkKSByZXR1cm4gZGVmYXVsdFZhbHVlO1xuXG5cdFx0Zm9yICh2YXIgZW51bVByb3AgaW4gZW51bVR5cGUpIHtcblx0XHRcdGlmIChlbnVtUHJvcC50b0xvd2VyQ2FzZSgpID09PSBlbnVtVmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgZW51bVR5cGVbZW51bVByb3BdID09PSBcInN0cmluZ1wiKVxuXHRcdFx0XHRcdHJldHVybiBlbnVtVHlwZVtlbnVtVHlwZVtlbnVtUHJvcF1dO1xuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0cmV0dXJuIGVudW1UeXBlW2VudW1Qcm9wXTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aHJvdyBuZXcgRXJyb3IoYFVucmVjb2duaXNlZCB2YWx1ZSBbJHtlbnVtVmFsdWV9XWApO1xuXHR9XG5cblx0cHVibGljIGdldCBvcHRpb25zKCk6IENvbWJpbmVkT3B0aW9ucyB7XG5cdFx0cmV0dXJuIHRoaXMuX29wdGlvbnM7XG5cdH1cbiAgIFxuXHRwdWJsaWMgZ2V0RGVmYXVsdExpYkZpbGVOYW1lKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIFwidHlwZXNjcmlwdC9saWIvbGliLmVzNi5kLnRzXCI7XG5cdH1cblxuXHRwdWJsaWMgdXNlQ2FzZVNlbnNpdGl2ZUZpbGVOYW1lcygpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRwdWJsaWMgZ2V0Q2Fub25pY2FsRmlsZU5hbWUoZmlsZU5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG5cdFx0cmV0dXJuICh0cyBhcyBhbnkpLm5vcm1hbGl6ZVBhdGgoZmlsZU5hbWUpO1xuXHR9XG5cblx0cHVibGljIGdldEN1cnJlbnREaXJlY3RvcnkoKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gXCJcIjtcblx0fVxuXG5cdHB1YmxpYyBnZXROZXdMaW5lKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIFwiXFxuXCI7XG5cdH1cblxuXHRwdWJsaWMgcmVhZEZpbGUoZmlsZU5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudGVkXCIpO1xuXHR9XG5cblx0cHVibGljIHdyaXRlRmlsZShuYW1lOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgd3JpdGVCeXRlT3JkZXJNYXJrOiBib29sZWFuKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudGVkXCIpO1xuXHR9XG5cblx0cHVibGljIGdldFNvdXJjZUZpbGUoZmlsZU5hbWU6IHN0cmluZyk6IFNvdXJjZUZpbGUge1xuXHRcdGZpbGVOYW1lID0gdGhpcy5nZXRDYW5vbmljYWxGaWxlTmFtZShmaWxlTmFtZSk7XG5cdFx0cmV0dXJuIHRoaXMuX2ZpbGVzW2ZpbGVOYW1lXTtcblx0fVxuXG5cdHB1YmxpYyBnZXRBbGxGaWxlcygpOiBTb3VyY2VGaWxlW10ge1xuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuX2ZpbGVzKS5tYXAoa2V5ID0+IHRoaXMuX2ZpbGVzW2tleV0pO1xuXHR9XG5cblx0cHVibGljIGZpbGVFeGlzdHMoZmlsZU5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiAhIXRoaXMuZ2V0U291cmNlRmlsZShmaWxlTmFtZSk7XG5cdH1cblxuXHRwdWJsaWMgYWRkRmlsZShmaWxlTmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBTb3VyY2VGaWxlIHtcblx0XHRmaWxlTmFtZSA9IHRoaXMuZ2V0Q2Fub25pY2FsRmlsZU5hbWUoZmlsZU5hbWUpOyAgICAgIFxuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuX2ZpbGVzW2ZpbGVOYW1lXTtcbiAgICAgIFxuICAgICAgaWYgKCFmaWxlKSB7XG5cdFx0ICAgdGhpcy5fZmlsZXNbZmlsZU5hbWVdID0gdHMuY3JlYXRlU291cmNlRmlsZShmaWxlTmFtZSwgdGV4dCwgdGhpcy5fb3B0aW9ucy50YXJnZXQpO1xuICAgICAgICAgbG9nZ2VyLmRlYnVnKGBhZGRlZCAke2ZpbGVOYW1lfWApOyAgICAgICAgIFxuICAgICAgfVxuICAgICAgZWxzZSBpZiAoZmlsZS50ZXh0ICE9IHRleHQpIHtcbiAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBvbmVcbiAgICAgICAgIHRoaXMuX2ZpbGVzW2ZpbGVOYW1lXSA9IHRzLmNyZWF0ZVNvdXJjZUZpbGUoZmlsZU5hbWUsIHRleHQsIHRoaXMuX29wdGlvbnMudGFyZ2V0KTtcbiAgICAgICAgIHRoaXMuaW52YWxpZGF0ZShmaWxlTmFtZSk7XG4gICAgICAgICBsb2dnZXIuZGVidWcoYHVwZGF0ZWQgJHtmaWxlTmFtZX1gKTsgICAgICAgICBcbiAgICAgIH1cblx0XHRcblx0XHRyZXR1cm4gdGhpcy5fZmlsZXNbZmlsZU5hbWVdO1xuXHR9XG5cbiAgIHByaXZhdGUgaW52YWxpZGF0ZShmaWxlTmFtZTogc3RyaW5nLCBzZWVuPzogc3RyaW5nW10pIHtcbiAgICAgIHNlZW4gPSBzZWVuIHx8IFtdO1xuICAgICAgXG4gICAgICBpZiAoc2Vlbi5pbmRleE9mKGZpbGVOYW1lKSA8IDApIHtcbiAgICAgICAgIHNlZW4ucHVzaChmaWxlTmFtZSk7XG4gICAgICAgICBcbiAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLl9maWxlc1tmaWxlTmFtZV07XG4gICAgICAgICBcbiAgICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICBmaWxlLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGZpbGUuZXJyb3JzID0gW107XG4gICAgICAgICB9XG4gICAgICAgICBcbiAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuX2ZpbGVzKVxuICAgICAgICAgICAgLm1hcChrZXkgPT4gdGhpcy5fZmlsZXNba2V5XSlcbiAgICAgICAgICAgIC5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgICAgICAgICAgaWYgKGZpbGUuZGVwZW5kZW5jaWVzICYmIGZpbGUuZGVwZW5kZW5jaWVzLmxpc3QuaW5kZXhPZihmaWxlTmFtZSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlKGZpbGUuZmlsZU5hbWUsIHNlZW4pO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICB9XG4gICB9XG4gICBcblx0Lypcblx0XHRPdmVycmlkZXMgdGhlIHN0YW5kYXJkIHJlc29sdXRpb24gYWxnb3JpdGhtIHVzZWQgYnkgdGhlIGNvbXBpbGVyIHNvIHRoYXQgd2UgY2FuIHVzZSBzeXN0ZW1qc1xuXHRcdHJlc29sdXRpb24uIEJlY2F1c2UgVHlwZVNjcmlwdCByZXF1aXJlcyBzeW5jaHJvbm91cyByZXNvbHV0aW9uLCBldmVyeXRoaW5nIGlzIHByZS1yZXNvbHZlZFxuXHRcdGJ5IHRoZSB0eXBlLWNoZWNrZXIgYW5kIHJlZ2lzdGVyZWQgd2l0aCB0aGUgaG9zdCBiZWZvcmUgdHlwZS1jaGVja2luZy5cblx0Ki9cblx0cHVibGljIHJlc29sdmVNb2R1bGVOYW1lcyhtb2R1bGVOYW1lczogc3RyaW5nW10sIGNvbnRhaW5pbmdGaWxlOiBzdHJpbmcpOiB0cy5SZXNvbHZlZE1vZHVsZVtdIHtcblx0XHRyZXR1cm4gbW9kdWxlTmFtZXMubWFwKChtb2ROYW1lKSA9PiB7XG5cdFx0XHRjb25zdCBkZXBlbmRlbmNpZXMgPSB0aGlzLl9maWxlc1tjb250YWluaW5nRmlsZV0uZGVwZW5kZW5jaWVzO1xuXG5cdFx0XHRpZiAoaXNIdG1sKG1vZE5hbWUpKSB7XG5cdFx0XHRcdHJldHVybiB7IHJlc29sdmVkRmlsZU5hbWU6IF9fSFRNTF9NT0RVTEVfXyB9O1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAoZGVwZW5kZW5jaWVzKSB7XG5cdFx0XHRcdGNvbnN0IHJlc29sdmVkRmlsZU5hbWUgPSBkZXBlbmRlbmNpZXMubWFwcGluZ3NbbW9kTmFtZV07XG5cdFx0XHRcdGNvbnN0IGlzRXh0ZXJuYWxMaWJyYXJ5SW1wb3J0ID0gaXNUeXBlc2NyaXB0RGVjbGFyYXRpb24ocmVzb2x2ZWRGaWxlTmFtZSk7XG5cblx0XHRcdFx0cmV0dXJuIHsgcmVzb2x2ZWRGaWxlTmFtZSwgaXNFeHRlcm5hbExpYnJhcnlJbXBvcnQgfTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdHMucmVzb2x2ZU1vZHVsZU5hbWUobW9kTmFtZSwgY29udGFpbmluZ0ZpbGUsIHRoaXMuX29wdGlvbnMsIHRoaXMpLnJlc29sdmVkTW9kdWxlO1xuXHRcdFx0XHQvLyBcdHRocm93IG5ldyBFcnJvcihgY29udGFpbmluZyBmaWxlICR7Y29udGFpbmluZ0ZpbGV9IGhhcyBub3QgYmVlbiBsb2FkZWRgKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxufVxuIl19